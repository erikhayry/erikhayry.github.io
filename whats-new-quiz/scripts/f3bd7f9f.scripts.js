"use strict";angular.module("whatsNewQuizApp",["ngRoute"]).config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"GameCtrl"}).when("/products",{templateUrl:"views/products.html",controller:"ProductCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("whatsNewQuizApp").controller("GameCtrl",["$scope","$route","$timeout","$location","$window","gameFactory","productFactory",function(a,b,c,d,e,f,g){function h(){return Math.random()<.5?f.getRandomDesigner(a.products[0].manufacturer,o.designers):a.products[0].manufacturer}function i(){g.resetViewedProducts(),a.isLoading=!0,a.showHelp=!1,a.isGameOver=!1,a.products=[],a.lives=[1,2,3],e.ga("send","event","gameActions","start new round"),c(function(){a.result=""},p),n=0,f.buildGame().then(function(b){a.version=b.version,a.isLoading=!1,o=b;for(var c=0;5>c;c++)o.products[n+c]&&(a.products[c]=o.products[n+c]);a.question=h(),a.score=n,a.total=o.products.length})}function j(){c(function(){a.result=""},p),n++,a.score=n,a.products.splice(0,1),n<a.total?(o.products[n+5]&&a.products.push(o.products[n+5]),a.question=h()):m()}function k(){return a.result="right",c(function(){j()},p),!0}function l(){return a.result="wrong",a.lives.splice(0,1),0==a.lives.length?(e.ga("send","event","gameActions","game over","",a.score),c(function(){a.isGameOver=!0,f.saveGame(a)},p),!1):(c(function(){j()},p),!1)}function m(){e.ga("send","event","gameActions","success"),a.result="",a.isGameOver=!0}var n,o=[],p=1e3,q=f.getSavedGame();q.total?(a.total=q.total,a.isGameOver=q.isGameOver,a.score=q.score):i(),a.checkAnswer=function(b,c,d){return g.addViewedProduct(a.products[0]),b===c===d?k():l()},a.restart=function(){i()},a.reload=function(){location.reload()},a.htmlEncode=function(a){return String(a).replace("&amp;","&").replace("&quot;",'"').replace("&#39;","'")},a.toggleHelp=function(){a.showHelp=!a.showHelp},a.pluralize=function(a){return 1==a?"point":"points"},a.getUrl=function(){return d.absUrl()},a.getClass=function(b){switch(b){case"help":return a.showHelp?"is-visible":"is-hidden";case"result":return"is-"+a.result}},a.getText=function(b){switch(b){case"help":return a.showHelp?"x":"?";case"result":return"right"===a.result?String.fromCharCode(10004):"x"}}}]),angular.module("whatsNewQuizApp").factory("productFactory",["$http",function(a){var b=[];return{getProducts:function(){return a.get("./data/data.json")},getViewedProducts:function(){return b},addViewedProduct:function(a){return b.push(a)},resetViewedProducts:function(){b=[]}}}]),angular.module("whatsNewQuizApp").factory("gameFactory",["$q","productFactory",function(a,b){function c(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function d(a,b){return Math.floor(Math.random()*(b-a+1))+a}function e(a){var b=[];return a.forEach(function(a){-1===b.indexOf(a.manufacturer)&&b.push(a.manufacturer)}),b}function f(){var d=a.defer();return b.getProducts().success(function(a){var b={designers:e(a.products),products:c(a.products),version:a.version};d.resolve(b)}),d.promise}var g={};return{buildGame:function(){return g={},f()},saveGame:function(a){g.total=angular.copy(a.total),g.score=angular.copy(a.score),g.isGameOver=angular.copy(a.isGameOver)},getSavedGame:function(){return g},getRandomDesigner:function(a,b){for(var c=a;a===c;)c=b[d(0,b.length-1)];return c}}}]),angular.module("whatsNewQuizApp").directive("wnqDraggable",["$document","$window",function(){return navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,{restrict:"E",scope:{product:"=",result:"=",hasTouch:"=",leftAfter:"&wnqDraggableLeftAfter",rightAfter:"&wnqDraggableRightAfter"},replace:!0,template:'<div class="m-image"><img/><button ng-click="rightAfter()" ng-show="!result" class="m-image-true">&#10004</button><button ng-click="leftAfter()" ng-show="!result" class="m-image-false">x</button></div>',link:function(a,b){function c(a){j={x:a.changedTouches[0].pageX}}function d(b){if(b.preventDefault(),!a.result){var c=b.changedTouches[0].pageX-j.x,d=document.body.clientWidth/2-g.offsetWidth/2;if(g&&h){var e=Math.abs(.5*c);0>c?(g.style.visibility="visible",g.style.opacity=Math.abs(.01*c),g.style.marginLeft=e>d?d+"px":e+"px",h.style.visibility="hidden",h.style.opacity=0,h.style.marginRight=0):c>0&&(h.style.visibility="visible",h.style.opacity=Math.abs(.01*c),h.style.marginRight=e>d?d+"px":e+"px",g.style.visibility="hidden",g.style.opacity=0,g.style.marginLeft=0)}this.style.left=c+"px"}}function e(b){if(!a.result){var c=b.changedTouches[0].pageX-j.x,d=100,e=!0;c>d?(this.style.opacity=0,a.$apply(function(){e=a.rightAfter()})):-d>c&&(this.style.opacity=0,a.$apply(function(){e=a.leftAfter()})),e||navigator.vibrate&&navigator.vibrate(500),this.style.left=0,h&&g&&(h.style.visibility="hidden",g.style.visibility="hidden",h.style.opacity=0,g.style.opacity=0,h.style.marginRight=0,g.style.marginLeft=0)}}var f=b[0].querySelectorAll("img")[0],g=b[0].querySelectorAll(".m-image-false")[0],h=b[0].querySelectorAll(".m-image-true")[0],i="http://cache.net-a-porter.com/images/products/"+a.product+"/"+a.product;f.src=i+"_in_xl.jpg";var j=null;f.addEventListener("touchstart",c),f.addEventListener("touchmove",d),f.addEventListener("touchend",e)}}}]),angular.module("whatsNewQuizApp").directive("wngDetect",["$rootScope",function(a){return{restrict:"A",link:function(b,c){"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0?(c[0].classList.add("has-touch"),a.hasTouch=!0):a.hasTouch=!1}}}]),angular.module("whatsNewQuizApp").directive("twitter",[function(){return{link:function(a,b,c){setTimeout(function(){twttr.widgets.createShareButton(document.URL,b[0],function(){},{count:"none",text:c.text})})}}}]),angular.module("whatsNewQuizApp").controller("ProductCtrl",["$scope","$window","productFactory",function(a,b,c){b.ga("send","event","gameActions","view products"),a.products=c.getViewedProducts()}]);